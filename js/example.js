var fulldata=[
  {
    "name": "Ергалиев Жабал Ергалиевич",
    "region": "Акмолинская",
    "participant": 0,
    "initiator": 0,
    "position": null,
    "y": "Север"
  },
  {
    "name": "Акимов Рашит Каиржанович",
    "region": "Акмолинская",
    "participant": 19,
    "initiator": 1,
    "position": "Секретарь Комитета по аграрным вопросам, природопользованию и развитию сельских территорий",
    "y": "Север"
  },
  {
    "name": "Адильбеков Даурен Зекенович",
    "region": "Акмолинская",
    "participant": 7,
    "initiator": 6,
    "position": "Секретарь Комитета по экономической политике, инновационному развитию и предпринимательству",
    "y": "Север"
  },
  {
    "name": "Джумагазиев Мухтар Сабирович",
    "region": "Актюбинская",
    "participant": 21,
    "initiator": 5,
    "position": "Член комитета по аграрным вопросам, природопользованию и развитию сельских территорий",
    "y": "Запад"
  },
  {
    "name": "Сагиндыков Елеусин Наурызбаевич",
    "region": "Актюбинская",
    "participant": 0,
    "initiator": 0,
    "position": null,
    "y": "Запад"
  },
  {
    "name": "Тагимов Марат Мурзагалиевич",
    "region": "Актюбинская",
    "participant": 32,
    "initiator": 6,
    "position": "Член комитета по аграрным вопросам, природопользованию и развитию сельских территорий",
    "y": "Запад"
  },
  {
    "name": "Кылышбаев Нурлан Наурызович",
    "region": "Алматиская",
    "participant": 20,
    "initiator": 3,
    "position": "Член комитета по финансам и бюджету",
    "y": "Юг"
  },
  {
    "name": "Мусаханов Ансар Турсунканович",
    "region": "Алматиская",
    "participant": 18,
    "initiator": 6,
    "position": "Член комитета по аграрным вопросам, природопользованию и развитию сельских территорий",
    "y": "Юг"
  },
  {
    "name": "Мукашев Тулеубек Тулеуович",
    "region": "Алматы",
    "participant": 25,
    "initiator": 6,
    "position": "Секретарь Комитета по международным отношениям, обороне и безопасности",
    "y": "Юг"
  },
  {
    "name": "Бижанов Ахан Хусаинович",
    "region": "Алматы",
    "participant": 0,
    "initiator": 0,
    "position": null,
    "y": "Юг"
  },
  {
    "name": "Нукетаева Динар Жусупалиевна",
    "region": "Алматы",
    "participant": 26,
    "initiator": 6,
    "position": "Член комитета по социально-культурному развитию и науке",
    "y": "Юг"
  },
  {
    "name": "Джаксыбеков Серик Рыскельдинович",
    "region": "Астана",
    "participant": 23,
    "initiator": 2,
    "position": "Председатель комитета по экономической политике, инновационному развитию и предпринимательству",
    "y": "Север"
  },
  {
    "name": "Редкокашин Владимир Николаевич",
    "region": "Астана",
    "participant": 0,
    "initiator": 0,
    "position": null,
    "y": "Север"
  },
  {
    "name": "Мамытбеков Едил Куламкадырович",
    "region": "Астана",
    "participant": 25,
    "initiator": 11,
    "position": "Член комитета по экономической политике, инновационному развитию и предпринимательству",
    "y": "Север"
  },
  {
    "name": "Дюсембаев Гумар Ислямович",
    "region": "Атырауская",
    "participant": 0,
    "initiator": 0,
    "position": "Член комитета по финансам и бюджету",
    "y": "Запад"
  },
  {
    "name": "Енсегенов Сарсенбай Курманулы",
    "region": "Атырауская",
    "participant": 37,
    "initiator": 20,
    "position": "Член комитета по конституционному законодательству, судебной системе и правоохранительным органам",
    "y": "Запад"
  },
  {
    "name": "Ищанов Кайрат Кыдрбаевич",
    "region": "Атырауская",
    "participant": 0,
    "initiator": 0,
    "position": null,
    "y": "Запад"
  },
  {
    "name": "Абайдильдин Талгатбек Жамшитович",
    "region": "ВКО",
    "participant": 0,
    "initiator": 0,
    "position": null,
    "y": "Восток"
  },
  {
    "name": "Мусин Дуйсенгазы Магауянович",
    "region": "ВКО",
    "participant": 18,
    "initiator": 6,
    "position": "Член комитета по аграрным вопросам, природопользованию и развитию сельских территорий",
    "y": "Восток"
  },
  {
    "name": "Плотников Сергей Викторович",
    "region": "ВКО",
    "participant": 18,
    "initiator": 4,
    "position": "Член комитета по финансам и бюджету",
    "y": "Восток"
  },
  {
    "name": "Жолдасбаев Муратбай Сматаевич",
    "region": "Жамбылская",
    "participant": 31,
    "initiator": 3,
    "position": "Член комитета по экономической политике, инновационному развитию и предпринимательству",
    "y": "Юг"
  },
  {
    "name": "Астаев Ертаргын Какимбекович",
    "region": "Жамбылская",
    "participant": 0,
    "initiator": 0,
    "position": null,
    "y": "Юг"
  },
  {
    "name": "Нуралиев Абдалы Токбергенович",
    "region": "Жамбылская",
    "participant": 17,
    "initiator": 7,
    "position": "Член комитета по аграрным вопросам, природопользованию и развитию сельских территорий",
    "y": "Юг"
  },
  {
    "name": "Ахметов Рашит Сайранович",
    "region": "ЗКО",
    "participant": 0,
    "initiator": 0,
    "position": null,
    "y": "Запад"
  },
  {
    "name": "Мукаев Ербулат Рахметович",
    "region": "ЗКО",
    "participant": 22,
    "initiator": 4,
    "position": "Секретарь Комитета по финансам и бюджету",
    "y": "Запад"
  },
  {
    "name": "Турегалиев Нариман",
    "region": "ЗКО",
    "participant": 26,
    "initiator": 12,
    "position": "Член комитета по социально-культурному развитию и науке",
    "y": "Запад"
  },
  {
    "name": "Ершов Сергей Михайлович",
    "region": "Карагандинская",
    "participant": 21,
    "initiator": 2,
    "position": "Член комитета по социально-культурному развитию и науке",
    "y": "Север"
  },
  {
    "name": "Акылбай Серик Байсеитулы",
    "region": "Карагандинская",
    "participant": 0,
    "initiator": 0,
    "position": null,
    "y": "Север"
  },
  {
    "name": "Абдикеров Рыскали Калиакбарович",
    "region": "Карагандинская",
    "participant": 34,
    "initiator": 8,
    "position": "Член комитета по конституционному законодательству, судебной системе и правоохранительным органам",
    "y": "Север"
  },
  {
    "name": "Бектурганов Серик Чингисович",
    "region": "Костанайская",
    "participant": 17,
    "initiator": 1,
    "position": "Секретарь Комитета по социально-культурному развитию и науке",
    "y": "Север"
  },
  {
    "name": "Нургалиев Женис Мирасович",
    "region": "Костанайская",
    "participant": 17,
    "initiator": 0,
    "position": "Член комитета по финансам и бюджету",
    "y": "Север"
  },
  {
    "name": "Бактиярулы Мурат",
    "region": "Кызылординская",
    "participant": 21,
    "initiator": 10,
    "position": "Председатель комитета по социально-культурному развитию и науке",
    "y": "Юг"
  },
  {
    "name": "Еламанов Бекмырза Кайыпулы",
    "region": "Кызылординская",
    "participant": 21,
    "initiator": 4,
    "position": "Член комитета по аграрным вопросам, природопользованию и развитию сельских территорий",
    "y": "Юг"
  },
  {
    "name": "Бортник Михаил Михайлович",
    "region": "Мангистауская",
    "participant": 31,
    "initiator": 7,
    "position": "Член комитета по экономической политике, инновационному развитию и предпринимательству",
    "y": "Запад"
  },
  {
    "name": "Чельпеков Бактыбай Акбердыевич",
    "region": "Мангистауская",
    "participant": 11,
    "initiator": 2,
    "position": "Член комитета по финансам и бюджету",
    "y": "Запад"
  },
  {
    "name": "Кузеков Асхат Сайпиевич",
    "region": "Павлодарская",
    "participant": 0,
    "initiator": 0,
    "position": null,
    "y": "Север"
  },
  {
    "name": "Нурсипатов Нуржан Нурланбекович",
    "region": "Павлодарская",
    "participant": 20,
    "initiator": 10,
    "position": "Член комитета по международным отношениям, обороне и безопасности",
    "y": "Север"
  },
  {
    "name": "Кубенов Манат Шарапиденович",
    "region": "Павлодарская",
    "participant": 0,
    "initiator": 0,
    "position": null,
    "y": "Север"
  },
  {
    "name": "Перепечина Ольга Валентиновна",
    "region": "СКО",
    "participant": 10,
    "initiator": 6,
    "position": "Председатель комитета по финансам и бюджету",
    "y": "Север"
  },
  {
    "name": "Султанов Ерик Хамзинович",
    "region": "СКО",
    "participant": 26,
    "initiator": 4,
    "position": "Член комитета по экономической политике, инновационному развитию и предпринимательству",
    "y": "Север"
  },
  {
    "name": "Билялов Серик Султангазинович",
    "region": "СКО",
    "participant": 0,
    "initiator": 0,
    "position": null,
    "y": "Север"
  },
  {
    "name": "Сулеймен Ляззат Жанылыскызы",
    "region": "Указ",
    "participant": 1,
    "initiator": 0,
    "position": "Член комитета по конституционному законодательству, судебной системе и правоохранительным органам",
    "y": "Указ"
  },
  {
    "name": "Адырбеков Икрам Адырбекович",
    "region": "Указ",
    "participant": 0,
    "initiator": 0,
    "position": null,
    "y": "Указ"
  },
  {
    "name": "Айтпаева Сауле Муханбедиановна",
    "region": "Указ",
    "participant": 21,
    "initiator": 12,
    "position": "Член комитета по конституционному законодательству, судебной системе и правоохранительным органам",
    "y": "Указ"
  },
  {
    "name": "Бобров Владимир Яковлевич",
    "region": "Указ",
    "participant": 0,
    "initiator": 0,
    "position": null,
    "y": "Указ"
  },
  {
    "name": "Ким Георгий Владимирович",
    "region": "Указ",
    "participant": 25,
    "initiator": 3,
    "position": null,
    "y": "Указ"
  },
  {
    "name": "Абыкаев Нуртай Абыкаевич",
    "region": "Указ",
    "participant": 0,
    "initiator": 0,
    "position": null,
    "y": "Указ"
  },
  {
    "name": "Громов Сергей Николаевич",
    "region": "Указ",
    "participant": 0,
    "initiator": 0,
    "position": null,
    "y": "Указ"
  },
  {
    "name": "Киинов Ляззат Кетебаевич",
    "region": "Указ",
    "participant": 0,
    "initiator": 0,
    "position": null,
    "y": "Указ"
  },
  {
    "name": "Кул-Мухаммед Мухтар Абрарулы",
    "region": "Указ",
    "participant": 16,
    "initiator": 0,
    "position": "Председатель комитета по международным отношениям, обороне и безопасности",
    "y": "Указ"
  },
  {
    "name": "Айтимова Бырганым Сариевна",
    "region": "Указ",
    "participant": 21,
    "initiator": 12,
    "position": null,
    "y": "Указ"
  },
  {
    "name": "Бекназаров Бектас Абдыханович",
    "region": "Указ",
    "participant": 1,
    "initiator": 0,
    "position": "Заместитель Председателя Сената Парламента Республики Казахстан",
    "y": "Указ"
  },
  {
    "name": "Жумагулов Бакытжан Турсынович",
    "region": "Указ",
    "participant": 22,
    "initiator": 1,
    "position": "Член комитета по социально-культурному развитию и науке",
    "y": "Указ"
  },
  {
    "name": "Жусип Нурторе Байтелесович",
    "region": "Указ",
    "participant": 0,
    "initiator": 0,
    "position": "Член комитета по социально-культурному развитию и науке",
    "y": "Указ"
  },
  {
    "name": "Лукин Андрей Иванович",
    "region": "Указ",
    "participant": 1,
    "initiator": 1,
    "position": "Член комитета по конституционному законодательству, судебной системе и правоохранительным органам",
    "y": "Указ"
  },
  {
    "name": "Куставлетов Дулат Рашитович",
    "region": "Указ",
    "participant": 22,
    "initiator": 8,
    "position": null,
    "y": "Указ"
  },
  {
    "name": "Полторабатько Людмила Григорьевна",
    "region": "Указ",
    "participant": 0,
    "initiator": 0,
    "position": null,
    "y": "Указ"
  },
  {
    "name": "Мусабаев Талгат Амангельдиевич",
    "region": "Указ",
    "participant": 24,
    "initiator": 4,
    "position": "Член комитета по международным отношениям, обороне и безопасности",
    "y": "Указ"
  },
  {
    "name": "Шакиров Аскар Оразалиевич",
    "region": "Указ",
    "participant": 0,
    "initiator": 0,
    "position": "Заместитель Председателя Сената Парламента Республики Казахстан",
    "y": "Указ"
  },
  {
    "name": "Алтынбаев Мухтар Капашевич",
    "region": "Указ",
    "participant": 0,
    "initiator": 0,
    "position": null,
    "y": "Указ"
  },
  {
    "name": "Назарбаева Дарига Нурсултановна",
    "region": "Указ",
    "participant": 18,
    "initiator": 6,
    "position": "Председатель Сената Парламента Республики Казахстан",
    "y": "Указ"
  },
  {
    "name": "Сафинов Канатбек Бейсенбекович",
    "region": "Указ",
    "participant": 0,
    "initiator": 0,
    "position": "Секретарь комитета по конституционному законодательству, судебной системе и правоохранительным органам",
    "y": "Указ"
  },
  {
    "name": "Бейсенбаев Аскар Асанович",
    "region": "Указ",
    "participant": 37,
    "initiator": 2,
    "position": null,
    "y": "Указ"
  },
  {
    "name": "Нуржигитова Дана Омирбаевна",
    "region": "Указ",
    "participant": 3,
    "initiator": 0,
    "position": "Член комитета по международным отношениям, обороне и безопасности",
    "y": "Указ"
  },
  {
    "name": "Токаев Касым-Жомарт Кемелевич",
    "region": "Указ",
    "participant": 0,
    "initiator": 0,
    "position": null,
    "y": "Указ"
  },
  {
    "name": "Оразалин Нурлан Мыркасымович",
    "region": "Указ",
    "participant": 0,
    "initiator": 0,
    "position": null,
    "y": "Указ"
  },
  {
    "name": "Волков Владимир Васильевич",
    "region": "Указ",
    "participant": 20,
    "initiator": 19,
    "position": "Председатель комитета по конституционному законодательству, судебной системе и правоохранительным органам",
    "y": "Указ"
  },
  {
    "name": "Калетаев Дархан Аманович",
    "region": "Указ",
    "participant": 11,
    "initiator": 1,
    "position": null,
    "y": "Указ"
  },
  {
    "name": "Кожамжаров Кайрат Пернешович",
    "region": "Указ",
    "participant": 4,
    "initiator": 2,
    "position": "Член комитета по международным отношениям, обороне и безопасности",
    "y": "Указ"
  },
  {
    "name": "Тусупбеков Рашид Толеутаевич",
    "region": "Указ",
    "participant": 27,
    "initiator": 0,
    "position": null,
    "y": "Указ"
  },
  {
    "name": "Капбарова Айгуль Жарылкасыновна",
    "region": "Шымкент",
    "participant": 0,
    "initiator": 0,
    "position": "Член комитета по социально-культурному развитию и науке",
    "y": "Юг"
  },
  {
    "name": "Бекназаров Нурлан Кудиярович",
    "region": "Шымкент",
    "participant": 6,
    "initiator": 0,
    "position": "Член комитета по конституционному законодательству, судебной системе и правоохранительным органам",
    "y": "Юг"
  },
  {
    "name": "Сатыбалды Дархан Амангельдиевич",
    "region": "Шымкент",
    "participant": 7,
    "initiator": 0,
    "position": null,
    "y": "Юг"
  },
  {
    "name": "Куртаев Алимжан Сейтжанович",
    "region": "ЮКО",
    "participant": 21,
    "initiator": 10,
    "position": "Член комитета по экономической политике, инновационному развитию и предпринимательству",
    "y": "Юг"
  },
  {
    "name": "Бектаев Али Абдикаримович",
    "region": "ЮКО",
    "participant": 13,
    "initiator": 11,
    "position": "Председатель комитета по аграрным вопросам, природопользованию и развитию сельских территорий",
    "y": "Юг"
  },
  {
    "name": "Айтаханов Куаныш Айтаханулы",
    "region": "ЮКО",
    "participant": 0,
    "initiator": 0,
    "position": null,
    "y": "Юг"
  }
] 
console.log(fulldata)

var width=500, height=300;
var margin={left:30,right:30, top:30, bottom:60};
var outerW=width+margin.left+margin.right;
var outerH = height+margin.top+margin.bottom;

var svg = d3.select("#chart").append("svg")
            .attr("width", outerW)
            .attr("height", outerH)
            .attr("transform", "translate("+margin.left+","+margin.top+")");

d3.select("#menu").append("ul")
   .selectAll("li")
   .data(d3.map(fulldata, d=>d.y).keys())
   .enter()
   .append("li").html(d=>d)
   .attr("id", d=>d)
   .on("mouseover",function(d){
   var id = d3.select(this).attr("id")
   renderChart(id)
   })
   .on("mouseout",function(d){
    renderChart()
   })

  var renderChart = function(id){
    var data = id!=null?fulldata.filter(d=>d.y==id):fulldata;
    svg.selectAll("g").remove()
   
    var t = d3.transition().duration(100);

    


    var agg_data = d3.nest().key(d=>d.region).rollup(d=>d3.sum(d, d=>d.participant)).entries(data)
    var agg_data = agg_data.sort((x,y)=>d3.ascending(x.value,y.value))
    
    var x = d3.scaleBand().domain(d3.map(agg_data, d=>d.key).keys()).range([0, width]).padding(0.1)
    var xAxis = d3.axisBottom(x)

    svg.append("g").attr("class","xaxis")
         .attr("transform", "translate("+margin.left+","+height+")")
         .transition(t)
         .call(xAxis)
         .selectAll("text")
         .attr("y",0)
         .attr("x",7)
         .attr("dy", "0.35em")
         .attr("transform","rotate(90)")
         .style("text-anchor","start");



    console.log(agg_data)

    var y = d3.scaleLinear().domain([0, d3.max(agg_data, d=>d.value)]).range([height,0])
    var yAxis = d3.axisLeft(y)

    svg.append("g")
       .attr("transform","translate("+margin.left+",0)")
       .transition(t)
       .call(yAxis)



    var rects = svg.append("g").attr("transform","translate("+margin.left+",0)").attr("class","bars")
                   .selectAll("rect")
                   .data(agg_data)

    

    rects.enter().append("rect").merge(rects)
         .attr("width", x.bandwidth())
         .attr("height", d=>height-y(d.value))
         .attr("x", d => x(d.key))
         .attr("y", d=>y(d.value))

    rects.exit().transition(t).attr("opacity",0.2).remove();
    
  }

  renderChart();
